\usepackage{bm}
% Vectors
\def\vzero{{\bm{0}}}
\def\vone{{\bm{1}}}
\def\vmu{{\bm{\mu}}}
\def\vtheta{{\bm{\theta}}}
\def\va{{\bm{a}}}
\def\vb{{\bm{b}}}
\def\vc{{\bm{c}}}
\def\vd{{\bm{d}}}
\def\ve{{\bm{e}}}
\def\vf{{\bm{f}}}
\def\vg{{\bm{g}}}
\def\vh{{\bm{h}}}
\def\vi{{\bm{i}}}
\def\vj{{\bm{j}}}
\def\vk{{\bm{k}}}
\def\vl{{\bm{l}}}
\def\vm{{\bm{m}}}
\def\vn{{\bm{n}}}
\def\vo{{\bm{o}}}
\def\vp{{\bm{p}}}
\def\vq{{\bm{q}}}
\def\vr{{\bm{r}}}
\def\vs{{\bm{s}}}
\def\vt{{\bm{t}}}
\def\vu{{\bm{u}}}
\def\vv{{\bm{v}}}
\def\vw{{\bm{w}}}
\def\vx{{\bm{x}}}
\def\vy{{\bm{y}}}
\def\vz{{\bm{z}}}


% Matrix
\def\mA{{\bm{A}}}
\def\mB{{\bm{B}}}
\def\mC{{\bm{C}}}
\def\mD{{\bm{D}}}
\def\mE{{\bm{E}}}
\def\mF{{\bm{F}}}
\def\mG{{\bm{G}}}
\def\mH{{\bm{H}}}
\def\mI{{\bm{I}}}
\def\mJ{{\bm{J}}}
\def\mK{{\bm{K}}}
\def\mL{{\bm{L}}}
\def\mM{{\bm{M}}}
\def\mN{{\bm{N}}}
\def\mO{{\bm{O}}}
\def\mP{{\bm{P}}}
\def\mQ{{\bm{Q}}}
\def\mR{{\bm{R}}}
\def\mS{{\bm{S}}}
\def\mT{{\bm{T}}}
\def\mU{{\bm{U}}}
\def\mV{{\bm{V}}}
\def\mW{{\bm{W}}}
\def\mX{{\bm{X}}}
\def\mY{{\bm{Y}}}
\def\mZ{{\bm{Z}}}
\def\mBeta{{\bm{\beta}}}
\def\mPhi{{\bm{\Phi}}}
\def\mLambda{{\bm{\Lambda}}}
\def\mSigma{{\bm{\Sigma}}}



\newtheorem{remark}{Remark}
\newtheorem{cor}{Corollary}
\newtheorem{condition}{Condition}
\newcommand{\loss}{\ell}
\newcommand{\losstext}{\text{loss}}
\newcommand{\pstar}{p^*}
\newcommand{\thetapre}{\theta_{\text{pre}}}

\newcommand{\classification}{\textsc{AstroClassification}\xspace}
\newcommand{\redshifts}{\textsc{Redshifts}\xspace}
\newcommand{\iwildcam}{\textsc{iWildCam-WILDS}\xspace}
\newcommand{\camelyon}{\textsc{Camelyon17-WILDS}\xspace}
\newcommand{\sft}{standard fine-tuning\xspace}
\newcommand{\Sft}{Standard fine-tuning\xspace}

% Misc. macros
\newcommand{\set}[1]{\left\{#1\right\}}
\newcommand{\absolute}[1]{|#1|}
\newcommand{\strongaugs}{strong-augs}

% Data macros
\newcommand{\augX}{\mX'}
\newcommand{\augXerr}{\mX'_{\text{err}}}
\newcommand{\Xin}{\mX}
\newcommand{\Xinerr}{\mX_{\text{err}}}
\newcommand{\znew}{z'}
\newcommand{\zorig}{z_{\text{orig}}}

\newcommand{\sourcedist}{P_S}
\newcommand{\targetdist}{P_T}
\newcommand{\unlabeldist}{P_U}
\newcommand{\sourcex}{\sX_\sS}
\newcommand{\targetx}{\sX_\sT}
\newcommand{\cdx}{\sX_{cd}}
\newcommand{\cdxsingle}{\inputx_{cd}}
\newcommand{\cdxo}[2]{\sX_{#1#2}} % class-domain pair with options
\newcommand{\cdxosingle}[2]{\inputx_{#1#2}}
\newcommand{\inputx}{x}
\newcommand{\labelvar}{y}
\newcommand{\labelx}{y_x}
\newcommand{\inputxp}{{x'}}
\newcommand{\labelxp}{y_{x'}}
\newcommand{\domainvar}{d}
\newcommand{\domainx}{d_x}
\newcommand{\domainxp}{d_{x'}}
\newcommand{\numcls}{r}
\newcommand{\numdom}{m}
\newcommand{\embeddim}{k}
\newcommand{\xsize}{N}
\newcommand{\cdsize}{n}
\newcommand{\posx}{\inputx^+}
\newcommand{\pospairdist}{S_+}
\newcommand{\dattract}{d_+}
\newcommand{\drepel}{d_-}

\newcommand{\inputspace}{\sX}
\newcommand{\labelspace}{\sY}
\newcommand{\repspace}{\sZ}
\newcommand{\aug}{\mathcal{A}_{\text{pre}}}
\newcommand{\augft}{\mathcal{A}_{\text{ft}}}
\newcommand{\augspace}{\mathcal{X}}
\newcommand{\augpoint}{x}
\newcommand{\natspace}{\overline{\mathcal{X}}}
\newcommand{\natpoint}{\overline{x}}
\DeclareMathOperator{\conn}{conn}
\newcommand{\Prob}[1]{\mathbb{P}\left[#1\right]}
\newcommand{\Probs}[2]{\mathbb{P}_{#1}\left[#2\right]}

\newcommand{\augproba}{{\alpha'}}
\newcommand{\augprobb}{{\beta'}}
\newcommand{\augprobg}{{\gamma'}}
\newcommand{\augprobr}{{\rho'}}

\newcommand{\pairproba}{{\alpha}}
\newcommand{\pairprobb}{{\beta}}
\newcommand{\pairprobg}{{\gamma}}
\newcommand{\pairprobr}{{\rho}}
\newcommand{\pairnorm}{{C}}

\newcommand{\posclass}{1}
\newcommand{\negclass}{-1}

\newcommand{\sbmg}{G}
\newcommand{\sbmv}{V}
\newcommand{\sbme}{E}

\newcommand{\losspre}{\losstext_{\text{pretrain}}}
\newcommand{\lossft}{\losstext_{\text{ft}}}

% Modeling macros
\newcommand{\encoder}{\phi}
\newcommand{\empencoder}{\widehat{\encoder}}
\newcommand{\empencoderMatrix}{\widehat{\Phi}}
\newcommand{\empencoderdann}{\widehat{\encoder}_\text{dann}}
\newcommand{\head}{h}
\newcommand{\dhead}{{\head}_{\text{dom}}}
\newcommand{\emphead}{\widehat{\head}}
\newcommand{\empheaddann}{\widehat{\head}_\text{dann}}
\newcommand{\clf}{f}
\newcommand{\empclf}{\widehat{\clf}}
\newcommand{\linmat}{B}
\newcommand{\emplinmat}{\widehat{\linmat}}
\newcommand{\empclferm}{\widehat{\clf}_\text{erm}}
\newcommand{\empclfdann}{\widehat{\clf}_\text{dann}}
\newcommand{\domainclf}{\dhead}
\newcommand{\domainclffam}{\sH_d}

% Objective
\newcommand{\lpretrain}{\sL_\text{pretrain}}
\newcommand{\ellpretrain}{\ell_\text{pretrain}}
\newcommand{\lfinetune}{\sL}
\newcommand{\ellfinetune}{\ell}
\newcommand{\elldomain}{\ell_d}
\newcommand{\batch}{M}
\newcommand{\auggraph}{G}
\newcommand{\Lzeroone}{\sL_{0-1}}
\newcommand{\Lerm}{\sL_\text{ERM}}
\newcommand{\Ldann}{\sL_\text{DANN}}
\newcommand{\LDzeroone}{\sL^{D}_{0-1}}


\newcommand{\lambdamax}{\lambda_{\text{max}}}
\newcommand{\onehot}{\text{one-hot}}
\newcommand{\lambdamin}{\lambda_{\text{min}}}
\newcommand{\fisherinfj}{I_{j,\thetastar}}
\newcommand{\fisherinfk}{I_{k,\thetastar}}
\newcommand{\conditionnum}{\gamma_{\thetastar}}
\newcommand{\fn}{f_n}
\newcommand{\rnthetastar}{r_n(\thetastar)}
\newcommand{\rntheta}{r_n(\theta)}
\newcommand{\dsname}{GINC\xspace}
\newcommand{\Topic}{Concept\xspace}
\newcommand{\Topics}{Concepts\xspace}
\newcommand{\topic}{concept\xspace}
\newcommand{\topics}{concepts\xspace}
\newcommand{\hiddenseg}{H}
\newcommand{\hiddensegstart}{h^{\text{start}}}
\newcommand{\hiddensegstarttest}{h^{\text{start}}_{\text{test}}}
\newcommand{\hiddensegstarttestprime}{{{h^{\text{start}}_{\text{test}}}'}}
\newcommand{\hiddensegend}{H^{\text{seg}}}
\newcommand{\hiddensegendtest}{H^{\text{seg}}_{\text{test}}}
\newcommand{\promptseq}{S_n}
\newcommand{\obsex}{O^{\text{ex}}}
\newcommand{\LCE}{L_{\text{CE}}}
\newcommand{\indicator}{\mathbf{1}}
\newcommand{\badset}{\sB}
\newcommand{\startconst}{\frac{1}{|\sD|}}
\newcommand{\delimub}{c_2}
\newcommand{\delimlb}{c_1}
\newcommand{\delimstartub}{c_4}
\newcommand{\delimstartlb}{c_3}
\newcommand{\translb}{c_5}
\newcommand{\emitlb}{c_6}
\newcommand{\examplelb}{c_7}
\newcommand{\hiddenstartlb}{c_8}
% \newcommand{\prompthiddenstartlb}{c_8}
% \newcommand{\prompthiddenstartub}{c_8}

\newcommand{\KLk}{KL_k(\thetastar \| \theta)}
\newcommand{\KLj}{KL_j(\thetastar \| \theta)}
\newcommand{\KLjprev}{KL^\theta_{j-1}}
\newcommand{\KLjnext}{KL^\theta_{j+1}}
\newcommand{\ppromptj}{\pprompt^j}
\newcommand{\pjtheta}{p^j_\theta}
\newcommand{\pjnexttheta}{p^{j+1}_\theta}
\newcommand{\pjthetastar}{p^j_\thetastar}
\newcommand{\pjnextthetastar}{p^{j+1}_\thetastar}
\newcommand{\ptwojtheta}{p^{(2,j)}_\theta}
\newcommand{\pijtheta}{p^{(i,j)}_\theta}
\newcommand{\ptwojthetastar}{p^{(2,j)}_\thetastar}
\newcommand{\pijthetastar}{p^{(i,j)}_\thetastar}
\newcommand{\ptwojnexttheta}{p^{(2,j+1)}_\theta}
\newcommand{\pijnexttheta}{p^{(i,j+1)}_\theta}
\newcommand{\ptwojnextthetastar}{p^{(2,j+1)}_\thetastar}
\newcommand{\pijnextthetastar}{p^{(i,j+1)}_\thetastar}

\newcommand{\errstart}{\epsilon^\theta_{\text{start}}}
\newcommand{\errdelim}{\epsilon^\theta_{\text{delim}}}


\newcommand{\h}{h}
\newcommand{\obs}{o}
\newcommand{\obsset}{\sO}
\newcommand{\delim}{h^{\text{delim}}}
\newcommand{\obsseg}{O}
\newcommand{\obsdelim}{o^{\text{delim}}}
\newcommand{\X}{x}
\newcommand{\y}{y}
\newcommand{\Xtest}{x_{\text{test}}}
\newcommand{\ytest}{y_{\text{test}}}
\newcommand{\bigK}{K}

\newcommand{\hatp}{\hat{p}}
\newcommand{\pprompt}{p_{\text{prompt}}}
\newcommand{\ppromptstart}{p_{\text{prompt}}}
\newcommand{\ppromptdelim}{p_{\text{prompt}}^{\text{delim}}}
\newcommand{\unif}{\text{Unif}}
\newcommand{\betax}{\beta(x_{n+1})}



\newcommand{\Tic}{\sT_{\text{in-context}}}

\newcommand{\minv}{{-1}}
\newcommand{\softmax}{\text{softmax}}
\newcommand{\minimize}{\text{minimize}}
\newcommand{\thetastar}{{\theta^*}}
\newcommand{\statdistpiH}{\pi^\thetastar}
\newcommand{\statdistpiHx}{\pi_x^\thetastar}
\newcommand{\statdistpiHtheta}{\pi^\theta}
\newcommand{\statdistpiHthetax}{\pi_x^\theta}
\newcommand{\statdistpiD}{\pi^\thetastar_\sD}
\newcommand{\statdistpiDtheta}{\pi^\theta_\sD}
\newcommand{\conetheta}{C_1^\theta(\epsilon^\theta(t_n))}
\newcommand{\ctwotheta}{C_2^\theta(\epsilon^\theta(t_n))}
\newcommand{\conethetastar}{C_1^\thetastar(\epsilon^\thetastar(t_n))}
\newcommand{\ctwothetastar}{C_2^\thetastar(\epsilon^\thetastar(t_n))}
\newcommand{\conethetat}{C_1^\theta(\epsilon^\theta(t))}
\newcommand{\ctwothetat}{C_2^\theta(\epsilon^\theta(t))}
\newcommand{\conethetastart}{C_1^\thetastar(\epsilon^\thetastar(t))}
\newcommand{\ctwothetastart}{C_2^\thetastar(\epsilon^\thetastar(t))}

\newcommand{\tilf}{\tilde{f}}
\newcommand{\maximize}{\text{maximize}}
\newcommand{\spoc}{\textsc{SPoC}}
\newcommand{\testp}{\textsc{TestP}}
\newcommand{\testw}{\textsc{TestW}}
\newcommand{\Pibeta}{\Pi_{\beta}}
\newcommand{\hatalpha}{\hat{\alpha}}
% \newcommand{\fstd}{f_{\theta_{\text{direct}}}}
% \newcommand{\fstdi}{f_{\theta_{\text{direct},i}}}
\newcommand{\fstd}{f_{\text{direct}}}
\newcommand{\fstdi}{f_{\text{direct},j}}
\newcommand{\fhatpi}{\hat{f}_{\Pi}}
\newcommand{\fpi}{f_{\Pi}}
\newcommand{\hattheta}{\hat{\theta}}
\newcommand{\ftheta}{f_{\theta}}
\newcommand{\fthetai}{f_{\theta_j}}
\newcommand{\fthetamin}{f_{\theta_{\text{min}}}}
\newcommand{\fthetabasemin}{f^*_{\text{base}}}
\newcommand{\fthetabase}{f_{\text{base}}}
\newcommand{\fthetacomp}{f_{\text{comp}}}
\newcommand{\fhattheta}{\hat{f}_{\theta}}
\newcommand{\fhat}{\hat{f}}
\newcommand{\fstar}{f^\star}
\newcommand{\proj}{\text{proj}}
\newcommand{\projC}{\text{proj}_{C}}
% \newcommand{\sign}{\text{sign}}
\newcommand{\thetareg}{{\theta_{\text{reg}}}}
\newcommand\uy{\tilde y}
\newcommand\noiseuy{\tilde z}
\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathOperator*{\argmax}{arg\,max}

\newcommand{\yone}{\y_{\text{max}}}


% WIDEBAR COMMAND
\newlength{\widebarargwidth}
\newlength{\widebarargheight}
\newlength{\widebarargdepth}
\DeclareRobustCommand{\widebar}[1]{%
    \settowidth{\widebarargwidth}{\ensuremath{#1}}%
    \settoheight{\widebarargheight}{\ensuremath{#1}}%
    \settodepth{\widebarargdepth}{\ensuremath{#1}}%
    \addtolength{\widebarargwidth}{-0.3\widebarargheight}%
    \addtolength{\widebarargwidth}{-0.3\widebarargdepth}%
    \makebox[0pt][l]{\hspace{0.3\widebarargheight}%
    \hspace{0.3\widebarargdepth}%
    \addtolength{\widebarargheight}{0.3ex}%
    \rule[\widebarargheight]{0.95\widebarargwidth}{0.1ex}}%
{#1}}



